---
- name: ubuntu latest packages update/upgrade and clean
  block:
    - name: update all packages to the latest version
      apt:
        upgrade: dist
    - name: run the equivalent of "apt-get update" as a separate step
      apt:
        update_cache: yes
    - name: remove useless packages from the cache
      apt:
        autoclean: yes
    - name: remove dependencies that are no longer required
      apt:
        autoremove: yes

- name: add local pub key to authorized_keys
  authorized_key:
    user: root
    key: "{{ lookup('file', 'id_rsa.pub') }}"
    state: present

- name: tweak sshd_config
  lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: ".*UseDNS.*"
    line: "UseDNS no"

- name: install common packages
  package:
    name: "{{ item }}"
    state: latest
  loop: "{{ common_packages }}"
